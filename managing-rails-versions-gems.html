<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Managing Rails Versions and Gems</title>
    <link rel="stylesheet" href="/css/screen.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="/css/gollum.css" type="text/css" charset="utf-8" />
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" charset="utf-8" />
    <script src="http://code.jquery.com/jquery-1.6.min.js" type="text/javascript"></script>
    <script src="/javascript/jquery.text_selection-1.0.0.min.js" type="text/javascript"></script>
    <script src="/javascript/jquery.previewable_comment_form.js" type="text/javascript"></script>
    <script src="/javascript/jquery.tabs.js" type="text/javascript"></script>
    <script src="/javascript/gollum.js" type="text/javascript"></script>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-5109366-14']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <div id="main">
      <div class="site">
        <div id="guides">
          <div class="guide">
            <div class="main">
              <div class="actions">
                <div>
                  <a href="http://railsapps.github.com/">Rails Apps</a>
                </div>
                <divstyle="float: right;">
                  <a href="https://github.com/RailsApps">GitHub Repository</a>
                </div>
              </div>
              <div class="content wikistyle gollum textile">
                <h1>Managing Rails Versions and Gems</h1>
<p>The Ruby on Rails platform is an ecosystem: an interacting community of developers, their projects, and complex dependencies among the projects. At times (often before and after the release of a major new version of Rails) the ecosystem enters a state of disequilibrium and important pieces no longer work together easily. These times of disequilibrium are innovative and valuable for the ecosystem because, as a whole, Rails improves during these times. For you as a developer, it may feel like a trainwreck. You productivity will stall as you try to sort out what is broken and how to fix it.</p>
<p>The example apps from the <a href="http://railsapps.github.com/">Rails Apps</a> repository can be helpful. Each shows a set of useful, popular Rails gems that are integrated into a working application. Each example app is known to work and can serve as your personal &#x201C;reference implementation&#x201D;. Each is an open source project so many people use the apps and report problems and propose solutions as GitHub issues.</p>
<p>These examples from the RailsApps project provide a working <strong>Rails app</strong> with a <strong>detailed tutorial</strong> plus an <strong>application template</strong> that can be used to create a <strong>starter app</strong>.</p>
<table><tr><th>Author </th>
		<th>Example App </th>
		<th>Tutorial </th>
		<th>App Template </th>
		<th>Comments </th>
	</tr><tr><td> Daniel Kehoe </td>
		<td> <a href="https://github.com/railsapps/rails3-devise-rspec-cucumber">Devise, RSpec, Cucumber</a> </td>
		<td> <a href="https://github.com/railsapps/rails3-devise-rspec-cucumber/wiki/Tutorial">Tutorial</a> </td>
		<td> <a href="https://github.com/RailsApps/rails3-application-templates">App Template</a>  </td>
		<td> Uses ActiveRecord and SQLite </td>
	</tr><tr><td> Daniel Kehoe </td>
		<td> <a href="https://github.com/railsapps/rails3-mongoid-devise">Devise, Mongoid</a> </td>
		<td> <a href="http://github.com/railsapps/rails3-mongoid-devise/wiki/Tutorial">Tutorial</a> </td>
		<td> <a href="https://github.com/RailsApps/rails3-application-templates">App Template</a>  </td>
		<td>  Combines Devise with MongoDB </td>
	</tr><tr><td> Daniel Kehoe </td>
		<td> <a href="https://github.com/railsapps/rails3-mongoid-omniauth">OmniAuth, Mongoid</a> </td>
		<td> <a href="https://github.com/railsapps/rails3-mongoid-omniauth/wiki/Tutorial">Tutorial</a> </td>
		<td> <a href="https://github.com/RailsApps/rails3-application-templates">App Template</a>  </td>
		<td>  Combines OmniAuth with MongoDB </td>
	</tr></table><p>Before you install one of the <a href="https://github.com/RailsApps">Rails example apps</a>, there are a few things you should know about managing the pieces of the Rails platform. Often, everything &#x201C;just works,&#x201D; but when it doesn&#x2019;t, here&#x2019;s what you need to review.</p>
<h2>Ruby</h2>
<p>Ruby is the programming language used for Rails projects.</p>
<p>What version of Ruby is installed on your machine? Check with:</p>
<p><code>$ ruby -v</code></p>
<p>For the example apps it should be version 1.9.2.</p>
<p>You can check for the current <a href="http://www.ruby-lang.org/en/downloads/">recommended version of Ruby</a>.</p>
<p>Use <a href="http://rvm.beginrescueend.com/">rvm</a> to install a newer version of Ruby if necessary (see more about rvm below).</p>
<h2>RubyGems</h2>
<p>RubyGems is a package management framework for Ruby. A gem is a packaged Ruby application or library. You can <a href="http://docs.rubygems.org/shelf/index">read more about gems</a> if you wish. Gems come from a wonderful pool of open source love but can be a headache to track and integrate.</p>
<p>The RubyGems package management system comes as part of a standard Ruby language installation.</p>
<p>What version of the RubyGems system is installed on your machine? Check with:</p>
<p><code>$ gem -v</code></p>
<p>For the example apps it should be version 1.7.2 (recommended) or newer.</p>
<p>Though the RubyGems package management system is part of a standard Ruby language installation, it can be updated by installing the rubygems-update gem.</p>
<p>You can check for the current <a href="https://rubygems.org/gems/rubygems-update">rubygems-update gem</a>.</p>
<p>Use <code>gem update --system</code> to upgrade the RubyGems system (but before you do, read the next paragraph).</p>
<p>As of release 1.8.0 (4 May 2011), the RubyGems system gem began a series of rapid updates and began displaying deprecation warnings that are very important for gem developers and very annoying for everyone else running Ruby. If you are using one of these &#x201C;noisy&#x201D; versions, you can roll back to an older version of RubyGems:</p>
<p><code>gem update --system 1.7.2</code></p>
<h2>Rails</h2>
<p>Rails itself is a gem, which means it can be installed and updated like any other gem.</p>
<p>What version of Rails is installed on your machine? Check with:</p>
<p><code>$ rails -v</code></p>
<p>For the example apps it should be version 3.1.</p>
<p>If you must use an earlier release of Rails, there is a Rails 3.0.7 branch of the examples in each repository.</p>
<p>You can check for the newest released <a href="https://rubygems.org/gems/rails">Rails version</a>.</p>
<p>Use <code>gem update rails</code> to install a newer version of Rails. It&#x2019;s recommended that you create a new gemset using <a href="http://rvm.beginrescueend.com/">rvm</a> before installing a new version of Rails (see below). With rvm, if you need to, you can switch gemsets to run your application under an earlier version of Rails.</p>
<h2>Rake</h2>
<p><a href="http://lukaszwrobel.pl/blog/rake-tutorial">Rake</a> is a software task management or &#x201C;build&#x201D; tool used extensively by Rails and many gems.</p>
<p>What version of rake is installed on your machine? Check with:</p>
<p><code>$ rake --version</code></p>
<p>You can check for the newest released <a href="https://rubygems.org/gems/rake">rake gem</a>.</p>
<p>For apps built with Rails 3.1, use the newest version of rake.</p>
<p>As of release 0.9.0 (20 May 2011), the rake gem broke Rails 3.0.7 and required Rails 3.1 (which was still in beta at the time). For apps built with Rails 3.0.7, use rake version 0.8.7. See how to bind rake to version 0.8.7 in the <a href="http://railsapps.github.com/rails-3-0-7-example-gemfile.html">Rails 3.0.7 example gemfile</a>.</p>
<h2>Bundler and the Gemfile</h2>
<p>The <a href="http://gembundler.com/">Ruby Bundler</a> manages an application&#x2019;s gems. Bundler works by reading a <strong>Gemfile</strong> in an application&#x2019;s root directory, downloading and unpacking specified versions of each required gem, resolving any dependencies among gems, and creating a <strong>Gemfile.lock</strong> file to force use of the specified gem versions.</p>
<p>Each of the example apps is provided with a gemfile that specifies a known working set of required gems.</p>
<p>After creating an example app, run <code>bundle install</code> to install all the necessary gems.</p>
<p>If you add a new gem to the gemfile, run <code>bundle install</code> again.</p>
<p>If you want to force an upgrade to all the gems that have newer versions, run <code>bundle update</code>. When you update a gem, bundler will not update a dependency of that gem if another gem still depends on it.</p>
<h2>Gem Version Constraint</h2>
<p>You will specify the gems you need in your application&#x2019;s Gemfile. If you don&#x2019;t specify a version, your application will use the newest gem version installed on your machine.</p>
<p>If you run <code>bundle update</code>, each gem will be updated to the newest available. You may benefit from the features (or the bug fixes) of the newest version. Or you may discover integration issues with other gems which cause failures. To avoid surprises and manage gem updates cautiously, you can specify gem versions in your Gemfile (<a href="http://docs.rubygems.org/read/chapter/16">described in the RubyGems manual</a>).</p>
<h4>Optimistic Version Constraint</h4>
<p>In the gemfiles for the example apps, you&#x2019;ll often see &#x201C;optimistic version constraint&#x201D; specified with the <code>&gt;=</code> operator like this:</p>
<p><code>gem 'devise', '&gt;= 1.3.4'</code></p>
<p>This means, &#x201C;use any version of the Devise gem that is newer than version 1.3.4.&#x201D; It will force an upgrade of the Devise gem to version 1.3.4 the first time you run <code>bundle update</code> and check and install newer versions each subsequent time you run <code>bundle update</code>. That&#x2019;s a good scheme for keeping your gems up-to-date unless there is a known issue with a gem.</p>
<h4>Pessimistic Version Constraint</h4>
<p>In the some gemfiles you may see &#x201C;pessimistic version constraint&#x201D; like this:</p>
<p><code>gem 'library', '~&gt; 2.2'</code></p>
<p>which is shorthand for</p>
<p><code>gem 'library', '&gt;= 2.2.0', '&lt; 3.0'</code></p>
<p>which means use any gem version newer than 2.2.0 but don&#x2019;t install 3.0 or anything newer.</p>
<p>We seldom specify pessimistic version constraint for gems in the example apps.</p>
<h4>Absolute Version Constraint</h4>
<p>In the example apps, we use &#x201C;absolute version constraint&#x201D; to specify a known working version of a gem if we&#x2019;ve seen reported problems with newer versions. Absolute version constraint looks like this:</p>
<p><code>gem 'library', '2.2'</code></p>
<h2>Gems for the Example Apps (Rails 3.1)</h2>
<p>For the example apps built with <strong>Rails 3.1</strong>, we recommend that you use the following gems and specify versions optimistically. Your <strong>Gemfile</strong> will look like this:</p>
<pre>
  source 'http://rubygems.org'

  gem 'rails', '&gt;= 3.1.0.beta1'
  gem 'sass'
  gem 'coffee-script'
  gem 'uglifier'
  gem 'jquery-rails'
  gem 'rspec-rails', '&gt;= 2.6.0', :group =&gt; [:development, :test]
  group :test do
  gem 'turn', :require =&gt; false
    gem 'factory_girl_rails', "&gt;= 1.1.beta1"
    gem 'cucumber-rails', "&gt;= 0.4.1"
    gem 'capybara', "&gt;= 0.4.1.2"
    gem 'database_cleaner', '&gt;= 0.6.7'
  end
</pre>
<p>You may use ActiveRecord with the SQLite database:</p>
<pre>
  gem 'sqlite3'
</pre>
<p>Alternatively, you may add Mongoid and the bson_ext gem for access to a MongoDB datastore:</p>
<pre>
  gem 'mongoid', '&gt;= 2.0.1'
  gem 'bson_ext', '&gt;= 1.3.1'
</pre>
<p>You may add Devise for authentication:</p>
<pre>
  gem 'devise', '&gt;= 1.3.4'
</pre>
<p>You may add OmniAuth for authentication:</p>
<pre>
  gem 'omniauth', '&gt;= 0.2.6'
</pre>
<h2>Gems for the Example Apps (Rails 3.0.7)</h2>
<p>If you must use Rails 3.0.7, see the <a href="http://railsapps.github.com/rails-3-0-7-example-gemfile.html">Rails 3.0.7 example gemfile</a>.</p>
<h2>Using rvm to Manage Multiple Versions of Rails</h2>
<p>I recommend installing rvm, the <a href="http://rvm.beginrescueend.com/">Ruby Version Manager</a>. It&#x2019;s essential if you must use multiple versions of Rails. And rvm makes it easy to switch sets of gems if you suspect a problem with incompatibilities among gems.</p>
<h4>Using the .rvmrc file for Project-Specific Gemsets</h4>
<p>After you&#x2019;ve created an rvm gemset that you&#x2019;ll use for a project, you can create an <strong>.rvmrc</strong> file in the application&#x2019;s root directory. <span class="caps">RVM</span> recgonizes an <strong>.rvmrc</strong> file in a directory and loads the gemset specified inside.</p>
<p>Here&#x2019;s how to create an <strong>.rvmrc</strong> file if you&#x2019;re using a gemset named &#x201C;ruby192@rails31beta&#x201D;:</p>
<pre>
$ echo "rvm use ruby192@rails31beta" &gt; .rvmrc
</pre>
<p>Using an <strong>.rvmrc</strong> file means you&#x2019;ll automatically be using the correct Rails and gem version when you run your application on your local machine. This works best if you create an rvm gemset specifically for your application.</p>
<h2>Suggestions?</h2>
<p>Got a correction or addition? Update the <a href="https://github.com/RailsApps/railsapps.github.com/wiki/managing-rails-versions-gems">wiki page</a> or create an <a href="https://github.com/RailsApps/railsapps.github.com/issues">issue</a> to alert me.</p>
              </div>
            </div>
          </div>
          <div class="comments">
            <h2>Comments</h2> 
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'railsapps'; // required: replace example with your forum shortname

                // The following are highly recommended additional parameters.
                // var disqus_identifier = 'managing-rails-versions-gems.html';
                // var disqus_url = 'http://railsapps.github.com/managing-rails-versions-gems.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>
          <br />
          <br />
          <div class="credits">
            <h2>Credits</h2> 
            <p>Daniel Kehoe (<a href="http://danielkehoe.com/">http://danielkehoe.com/</a>) initiated the project and wrote some examples and tutorials.</p>
            <p>Your contributions are welcome!</p>
          </div>
          <div class="admin">
            <small>Corrections? Additions? You can edit this page <a href="https://github.com/railsapps/railsapps.github.com/wiki/_pages">on the wiki</a>.</small>
            <div style="float: right;">
              <small>Last edited by <b>Daniel Kehoe</b>, 2011-05-23 12:43:57</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
